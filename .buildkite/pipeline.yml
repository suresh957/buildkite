env:
  CARTLINK: "${cartlink}"
  DEVICE: device
  
steps:
  - block: "Select CartLink"
    fields:
      - select: "Cart-Link"
        key: "cartlink"
        hint: "Select Cartlink to flash."
        required: true
        options:
          - label: "Cartlink=1"
            value: "cartlink=1"
          - label: "Cartlink-2"
            value: "cartlink-2"
          - label: "Cartlink=3"
            value: "cartlink=3"
          - label: "Cartlink-4"
            value: "cartlink-4"
          - label: "Cartlink-5"
            value: "cartlink-5"
          - label: "Cartlink-6"
            value: "cartlink-6"
          - label: "Cartlink-7"
            value: "cartlink-7"
          - label: "Cartlink-8"
            value: "cartlink-8"
          - label: "Cartlink-9"
            value: "cartlink-9"
          - label: "Cartlink-10"
            value: "cartlink-10"
  
  - block: ":closed_lock_with_key: CartLink"
    prompt: ":warning:Please select the unit to flash:warning:"  
    
  - block: "Select Uint"
    fields:
      - select: "Device"
        key: "device"
        hint: "Select Device to flash."
        multiple: true
        options:
          - label: "ADL"
            value: "adl"
          - label: "ADR"
            value: "adr"
          - label: "Maint"
            value: "maint"
          - label: "Tablet"
            value: "tablet"
            
  - label: Update Agent
    concurrency: 1
    concurrency_group: "link-iot-server"
    agents:
       cartlink=1
    command: "/bin/bash ${BUILDKITE_BUILD_CHECKOUT_PATH}/.buildkite/device.sh "
    
  - label: Show Details 
    concurrency: 1
    concurrency_group: "link-iot-server"
    agents:
       cartlink=3
    command: "echo $CARTLINK"
    command: "echo $(buildkite-agent meta-data get cartlink)"
    env:
      CARTLINK: "$(buildkite-agent meta-data get cartlink)"
